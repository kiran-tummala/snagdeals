{
  "name": "SnagDeals v6 â€” Scrape + Push to API",
  "nodes": [
    {
      "name": "Every 30 Minutes",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [200, 400],
      "parameters": {
        "rule": {
          "interval": [{ "field": "minutes", "minutesInterval": 30 }]
        }
      }
    },
    {
      "name": "1a SlickDeals RSS",
      "type": "n8n-nodes-base.rssFeedRead",
      "position": [450, 200],
      "parameters": {
        "url": "https://slickdeals.net/newsearch.php?rss=1&forumchoice%5B%5D=9&sort=newest"
      }
    },
    {
      "name": "1a Parse SlickDeals",
      "type": "n8n-nodes-base.code",
      "position": [650, 200],
      "parameters": {
        "jsCode": "var results = [];\nvar items = $input.all();\nfor (var i = 0; i < items.length; i++) {\n  var d = items[i].json;\n  var title = (d.title || '').trim();\n  if (title.length < 10) continue;\n  var priceMatch = title.match(/\\$(\\d+(?:\\.\\d{2})?)/);\n  var price = priceMatch ? parseFloat(priceMatch[1]) : 0;\n  var store = 'Amazon';\n  var t = title.toLowerCase();\n  if (t.indexOf('walmart') >= 0) store = 'Walmart';\n  else if (t.indexOf('best buy') >= 0) store = 'Best Buy';\n  else if (t.indexOf('target') >= 0) store = 'Target';\n  else if (t.indexOf('costco') >= 0) store = 'Costco';\n  else if (t.indexOf('newegg') >= 0) store = 'Newegg';\n  else if (t.indexOf('home depot') >= 0) store = 'Home Depot';\n  else if (t.indexOf('ebay') >= 0) store = 'eBay';\n  results.push({ json: { title: title.substring(0, 200), price: price, store: store, source: 'slickdeals', source_deal_id: 'sd-' + (d.guid || d.link || String(i)).replace(/[^a-zA-Z0-9]/g, '').substring(0, 40), deal_url: d.link || null, country: 'US' } });\n}\nreturn results;"
      }
    },
    {
      "name": "1b DealNews RSS",
      "type": "n8n-nodes-base.rssFeedRead",
      "position": [450, 400],
      "parameters": {
        "url": "https://www.dealnews.com/rss/"
      }
    },
    {
      "name": "1b Parse DealNews",
      "type": "n8n-nodes-base.code",
      "position": [650, 400],
      "parameters": {
        "jsCode": "var results = [];\nvar items = $input.all();\nfor (var i = 0; i < items.length; i++) {\n  var d = items[i].json;\n  var title = (d.title || '').trim();\n  if (title.length < 10) continue;\n  var priceMatch = title.match(/\\$(\\d+(?:\\.\\d{2})?)/);\n  var price = priceMatch ? parseFloat(priceMatch[1]) : 0;\n  var store = 'Amazon';\n  var t = title.toLowerCase();\n  if (t.indexOf('walmart') >= 0) store = 'Walmart';\n  else if (t.indexOf('best buy') >= 0) store = 'Best Buy';\n  else if (t.indexOf('target') >= 0) store = 'Target';\n  else if (t.indexOf('costco') >= 0) store = 'Costco';\n  else if (t.indexOf('newegg') >= 0) store = 'Newegg';\n  else if (t.indexOf('home depot') >= 0) store = 'Home Depot';\n  else if (t.indexOf('ebay') >= 0) store = 'eBay';\n  results.push({ json: { title: title.substring(0, 200), price: price, store: store, source: 'dealnews', source_deal_id: 'dn-' + (d.guid || d.link || String(i)).replace(/[^a-zA-Z0-9]/g, '').substring(0, 40), deal_url: d.link || null, country: 'US' } });\n}\nreturn results;"
      }
    },
    {
      "name": "1c DealsOfAmerica",
      "type": "n8n-nodes-base.httpRequest",
      "position": [450, 600],
      "parameters": {
        "url": "https://www.dealsofamerica.com",
        "method": "GET",
        "responseFormat": "text"
      }
    },
    {
      "name": "1c Parse DOA",
      "type": "n8n-nodes-base.code",
      "position": [650, 600],
      "parameters": {
        "jsCode": "var html = '';\ntry { html = $input.first().json.data || ''; } catch(e) { return []; }\nvar deals = [];\nvar regex = /<a[^>]*>([^<]{15,200})<\\/a>/gi;\nvar match;\nwhile ((match = regex.exec(html)) !== null && deals.length < 50) {\n  var title = match[1].trim();\n  if (title.length < 15) continue;\n  var hasPrice = /\\$|%|off|deal|save|sale|free/i.test(title);\n  if (!hasPrice) continue;\n  var priceMatch = title.match(/\\$(\\d+(?:\\.\\d{2})?)/);\n  var store = 'Amazon';\n  var t = title.toLowerCase();\n  if (t.indexOf('walmart') >= 0) store = 'Walmart';\n  else if (t.indexOf('best buy') >= 0) store = 'Best Buy';\n  else if (t.indexOf('target') >= 0) store = 'Target';\n  deals.push({ json: { title: title.substring(0, 200), price: priceMatch ? parseFloat(priceMatch[1]) : 0, store: store, source: 'dealsofamerica', source_deal_id: 'doa-' + title.toLowerCase().replace(/[^a-z0-9]/g, '').substring(0, 40), country: 'US' } });\n}\nreturn deals;"
      }
    },
    {
      "name": "2 Merge All",
      "type": "n8n-nodes-base.code",
      "position": [900, 400],
      "parameters": {
        "jsCode": "var items = $input.all();\nvar seen = {};\nvar results = [];\nvar storeColors = { 'Amazon': '#ff9900', 'Walmart': '#0071dc', 'Target': '#cc0000', 'Costco': '#e31837', 'Best Buy': '#0046be', 'Home Depot': '#f96302', 'Newegg': '#c11f1f', 'eBay': '#e43137' };\n\nfor (var i = 0; i < items.length; i++) {\n  var d = items[i].json;\n  if (!d || !d.title || d.title.length < 10) continue;\n  var key = d.title.toLowerCase().replace(/[^a-z0-9]/g, '').substring(0, 50);\n  if (seen[key]) continue;\n  seen[key] = true;\n  if (/expired|sold out|out of stock|ended|dead/i.test(d.title)) continue;\n  var price = parseFloat(d.price) || 0;\n  var origPrice = price > 0 ? Math.round(price * 1.4) : 0;\n  var discount = origPrice > 0 ? Math.round((1 - price / origPrice) * 100) : 25;\n  results.push({ json: { title: d.title, store: d.store || 'Amazon', store_color: storeColors[d.store] || '#86868b', emoji: 'tag', category: 'retail', price: price, original_price: origPrice, discount_percent: discount, source: d.source || 'manual', source_deal_id: d.source_deal_id || ('m-' + key), deal_url: d.deal_url || null, votes: Math.floor(Math.random() * 500) + 50, tags: discount >= 35 ? ['hot'] : [], shipping_info: d.store === 'Amazon' ? 'Free Prime' : 'Free Ship', country: d.country || 'US' } });\n}\nreturn results;"
      }
    },
    {
      "name": "3 Push to API",
      "type": "n8n-nodes-base.httpRequest",
      "position": [1100, 400],
      "parameters": {
        "method": "POST",
        "url": "https://snagdeals.cc/api/deals",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "Content-Type", "value": "application/json" },
            { "name": "x-api-key", "value": "snagdeals-api-key-change-me-2026" }
          ]
        },
        "sendBody": true,
        "bodyContentType": "raw",
        "rawContentType": "application/json",
        "body": "={{ JSON.stringify($input.all().map(function(item) { return item.json; })) }}"
      }
    },
    {
      "name": "4 Log Result",
      "type": "n8n-nodes-base.code",
      "position": [1300, 400],
      "parameters": {
        "jsCode": "var resp = $input.first().json;\nconsole.log('Done: ' + JSON.stringify(resp));\nreturn [{ json: { status: 'complete', response: resp, time: new Date().toISOString() } }];"
      }
    }
  ],
  "connections": {
    "Every 30 Minutes": {
      "main": [[
        { "node": "1a SlickDeals RSS" },
        { "node": "1b DealNews RSS" },
        { "node": "1c DealsOfAmerica" }
      ]]
    },
    "1a SlickDeals RSS": {
      "main": [[ { "node": "1a Parse SlickDeals" } ]]
    },
    "1a Parse SlickDeals": {
      "main": [[ { "node": "2 Merge All" } ]]
    },
    "1b DealNews RSS": {
      "main": [[ { "node": "1b Parse DealNews" } ]]
    },
    "1b Parse DealNews": {
      "main": [[ { "node": "2 Merge All" } ]]
    },
    "1c DealsOfAmerica": {
      "main": [[ { "node": "1c Parse DOA" } ]]
    },
    "1c Parse DOA": {
      "main": [[ { "node": "2 Merge All" } ]]
    },
    "2 Merge All": {
      "main": [[ { "node": "3 Push to API" } ]]
    },
    "3 Push to API": {
      "main": [[ { "node": "4 Log Result" } ]]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Chicago"
  }
}
